
&НаКлиенте
Процедура OneDrive(Команда)		
	ОчиститьСообщения();
	Если Объект.ПлатежныеДокументы.Количество() > 0 Тогда		
		АдресФайлаВоВременномХранилище = ВыгрузитьДокументы();		
		
		ИмяФайла	= СтрШаблон("%1 %2.txt"
		, Формат(ТекущаяДата(), "ДФ='yyyy.MM.dd HH-mm-ss'")
		, Строка(Объект.Организация));
		Путь		= "/1s/1s_to_kl/";
		Форма		= ПолучитьФорму("Обработка.OneDrive.Форма.ОтправкаФайла", Новый Структура("АдресВоВременномХранилище,ИмяФайла,Путь", АдресФайлаВоВременномХранилище, ИмяФайла, Путь), ЭтаФорма);
		Форма.Открыть();	
	
		ЭкспортПроизведен = Истина;		
		УстановитьСостояниеОтправленоСервер();
		ОповеститьОбИзменении(Тип("ДокументСсылка.ПлатежноеПоручение"));
		ОповеститьОбИзменении(Тип("ДокументСсылка.ПлатежноеТребование"));	
	Иначе		
		Если Объект.НачалоПериода = Объект.КонецПериода Тогда
			ТекстПериода = Формат(Объект.НачалоПериода, "ДФ=dd.MM.yyyy");
		Иначе
			ТекстПериода = НСтр("ru = 'период с %1 по %2'");
			ТекстПериода = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстПериода,
				Формат(Объект.НачалоПериода, "ДФ=dd.MM.yyyy"), 
				Формат(Объект.КонецПериода, "ДФ=dd.MM.yyyy"));
		КонецЕсли;     		
		ТекстСообщения = НСтр("ru = 'Отсутствуют платежные поручения за %1
			|по счету %2
			|(%3).
			|
			|Попробуйте изменить период или указать другой банковский счет.'"); 		
		ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			ТекстСообщения,
			ТекстПериода,
			Объект.БанковскийСчет,
			Объект.Организация);		
		ПоказатьПредупреждение(, ТекстСообщения);		
		Возврат;		
	КонецЕсли;	
	УправлениеФормой();
КонецПроцедуры
